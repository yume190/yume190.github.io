<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="#Search Drives User Engagement">
    

    <!--Author-->
    
        <meta name="author" content="Yume">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="IOS Search API"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Yume 練功地"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>IOS Search API - Yume 練功地</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2015/10/22/IOS-2015-10-22-IOS-Search-API/">
                IOS Search API
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2015-10-22</span>
            
            <a href="#disqus_thread" class="comments">Kommentare</a>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <p>#Search Drives User Engagement</p>
<a id="more"></a>
<p>Search in iOS 9 gives people great ways to access information inside of your app, even when it isn’t installed.</p>
<p>When you make your content searchable, users can access activities and content deep within your app through Spotlight and Safari search results, Handoff, Siri Suggestions, and Reminders. Making your content searchable helps you enhance the user experience of your app and improve its discoverability.</p>
<hr>
<p>App search is easy for you to adopt and customize.</p>
<p>You don’t need any prior experience with implementing search, and you control what content gets indexed, which information to show in search results, and where the user goes after tapping a result related to your content.</p>
<h3 id="兩種幫助使用者保護隱私的-索引方式-Indexes"><a href="#兩種幫助使用者保護隱私的-索引方式-Indexes" class="headerlink" title="兩種幫助使用者保護隱私的 索引方式 (Indexes)"></a>兩種幫助使用者保護隱私的 <code>索引方式</code> (Indexes)</h3><p>隱私是 iOS 9 基礎的搜尋功能。</p>
<p>它給予使用者最佳的搜尋體驗並保護他們的私人資料，Apple 提供了兩種 <code>索引方式</code>，能儲存可搜尋的項目相關於的你的內容。<br>there are two indexes that can store searchable items related to your content.</p>
<p>你可以使用許多 <code>搜尋相關</code> (search-related) APIs 對每個項目指出 相近的索引，所以了解每個索引的運作方式是非常重要低。</p>
<p>iOS 9 提供下列索引方式：</p>
<ul>
<li><p>裝置上的私有索引(A private on-device index)<br>每個裝置包含了私有索引(一種資訊且它並不會分享給 Apple 或 同步到其他裝置上)。<br>當你在使用者裝置上的索引建立了有效的項目，只有那位使用者能在搜尋結果看到那筆 <code>項目</code> (item)。</p>
</li>
<li><p>Apple Server 方的索引 (Apple’s server-side index)<br>Server 方的索引只有儲存在你網站上標示的公開有效資料。</p>
</li>
</ul>
<h3 id="Search-Consists-of-Several-Technologies"><a href="#Search-Consists-of-Several-Technologies" class="headerlink" title="Search Consists of Several Technologies"></a>Search Consists of Several Technologies</h3><p>為了讓使用者有更好的搜尋體驗並提高她們對的你的 APP 的 engagement，你可以結合不同的 APIs 和 技術。</p>
<p>在你開始之前，評估你的內容並決定要儲存的內容 跟 誰應該能夠訪問這筆資訊。</p>
<p>基於你的調查，選擇你該採用的 APIs 和技術。</p>
<hr>
<p>iOS 9 introduces several APIs that help you make your content available in the appropriate index.</p>
<ul>
<li><code>NSUserActivity</code> 有新的方法及屬性，能幫助你index items as users perform activities in your app,such as visiting a navigation point or creating and viewing content.</li>
<li>The Core Spotlight framework provides APIs that help you add app-specific content to the on-device index and enable deep links into your app.</li>
<li>Web markup lets you make your related web content searchable and helps you enrich the user’s search experience.</li>
</ul>
<hr>
<blockquote>
<p>NOTE<br>Although app search is available for iOS 9 users, the search functionality of NSUserActivity and Core Spotlight is not supported on iPhone 4s, iPad 2, iPad (3rd generation), iPad mini, and iPod touch (5th generation).</p>
</blockquote>
<hr>
<p>非常建議所有的 APP 使用 <code>NSUserActivity</code> 且它們支援 <code>Handoff</code>。</p>
<p>使用 <code>NSUserActivity 搜尋相關的屬性</code> 是展示給使用者他們關注的資訊最好的方式 並 提高你的搜索結果排名。</p>
<p>當使用者在你的 APP 執行一個活動，你可以使用 <code>NSUserActivity</code> 把這個項目加入到裝置上的索引。</p>
<p>在預設情況下， <code>NSUserActivity</code> 表現的項目是屬於私有的，這表示說這項目被加到裝置索引。</p>
<p>如果你內容物包含了讓所有使用者能夠觀看的活動，you identify them as eligible for public indexing.</p>
<hr>
<p>如果你的 APP 處理使用者儲存的資料，例如： 文件 照片 或其他型態的資料(使用者創建的或使用者參與一半)，可以使用 <code>Core Spotlight APIs</code> 對內容物上索引。</p>
<p>並不像 <code>NSUserActivity</code>， <code>Core Spotlight</code> 並不需要為了使用者訪問內容物，特別對內容物上索引</p>
<p>此外，你可以在任何地點用 <code>CoreSpotlight APIs</code> 索引內容物，例如當應用程序加載。</p>
<p><code>Core Spotlight</code> 能幫你讓項目在裝置上變得可搜尋;你不必用 <code>Core Spotlight APIs</code> 讓項目變成 可公開搜尋。</p>
<hr>
<p>如果你的 APP 主機網站有內容物(一些或全部)，使用 <code>web markup</code> 讓 Apple 的 <code>web crawler (called Applebot)</code> 在 APPLE Server 索引你的內容，並且讓你的內容讓所有 iOS 使用者在 <code>Spotlight and Safari search results</code> 搜尋的到。</p>
<p>Note that search results generated by web markup are shown in countries that are supported by Spotlight Suggestions.</p>
<hr>
<p>Regardless of the APIs you use to make content searchable, you can also let users take actions directly from a search result, such as making a phone call and getting directions to a location.</p>
<p>Users can get the actions you enable in views such as these:</p>
<table>
<thead>
<tr>
<th style="text-align:center">Make a phone call</th>
<th style="text-align:center">Get directions to a location</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><img src="/image/APP_Search/Contact_snip_2x.png" alt=""></td>
<td style="text-align:center"><img src="/image/APP_Search/Direction_snip_2x.png" alt=""></td>
</tr>
</tbody>
</table>
<hr>
<p>除了使用 <code>NSUserActivity</code> <code>Core Spotlight</code> <code>web markup</code>，你應該使用三個關鍵技術來給予使用者更好的體驗。</p>
<ul>
<li><code>Universal links</code><br>在 iOS 9 之後, 使用 <code>universal links</code> 來取代 <code>custom URL schemes with standard HTTP or HTTPS links</code>。<br><code>Universal links</code> work for all users: 如果使用者有安裝你的 APP， 這條 link 會帶領他們直接到妳的 APP; 反之如果他們沒有安裝你的 APP, 這條 link 會用 Safari 打開你的網站。</li>
<li><code>Smart App Banners</code><br>當使用者用 Safari 瀏覽你的網站，<code>Smart App Banner</code> 可以讓他們打開你的 APP (如果有安裝) 或 獲得他們下載妳 APP 的機會(如果沒裝)。</li>
<li><code>Handoff</code><br>Handoff lets users continue an activity from one device to another.<br>For example, when browsing a website on their Mac, they can jump straight to your native app on their iPad.<br>In iOS 9, Handoff includes specific support for app search. To learn more about supporting Handoff, see Handoff Programming Guide.</li>
</ul>
<h3 id="Several-Factors-Determine-the-Ranking-of-Search-Results"><a href="#Several-Factors-Determine-the-Ranking-of-Search-Results" class="headerlink" title="Several Factors Determine the Ranking of Search Results"></a>Several Factors Determine the Ranking of Search Results</h3><p>Adopting the search-related APIs appropriately can improve the relevancy and ranking of the search results related to your content.</p>
<p>To give users the best search experience, the system measures how often users interact with app content and with Spotlight and Safari results.</p>
<p>Because iOS measures the level of user engagement with search results, items that users don’t find useful are quickly identified and can eventually stop showing up in results.</p>
<hr>
<p>iOS determines relevancy and ranking using information such as:</p>
<ul>
<li>The frequency with which users view your content (which is captured only through the use of NSUserActivity)</li>
<li>The amount of engagement users have with your content, demonstrated when users tap a search result or find the information useful</li>
<li>In the case of marked-up web content, the popularity of a URL and the amount of structured data available</li>
</ul>
<hr>
<p>At a high level, you can provide great search results and encourage people to use your app by doing the following things:</p>
<ul>
<li>Create an app with compelling content.</li>
<li>Improve the relevance of your search results by adopting the search-related APIs just described.</li>
<li>As much as possible, index only the items that users are most likely to search for.</li>
<li>Keep the indexes up to date by removing and updating items when necessary.</li>
<li>Encourage users to engage with an indexed item by providing relevant, rich information about it.</li>
<li>Minimize the time between tapping on a search result and viewing the content in your app.</li>
</ul>
<p>To learn about ways to improve the user’s search experience, see Combine APIs to Increase Coverage and Improve the Ranking of Your Results.</p>
<hr>
<h1 id="Example-Implementations"><a href="#Example-Implementations" class="headerlink" title="Example Implementations"></a>Example Implementations</h1><p>實現搜尋的方式取決於妳的 APP 的 使用模型及使用者經驗(usage model and user experience)。</p>
<p>At a high level,你的實作決策建立在幾個主要問題上面：</p>
<ul>
<li>Do you have a website that hosts some or all of the content that’s in your app?</li>
<li>Does your app contain user-generated or user-specific data?</li>
<li>Does your app contain content that users are likely to want to revisit?</li>
</ul>
<p>Travel</p>
<p>In terms of search functionality, a travel app is similar to a ticket sales app, because it helps users plan for future events and buy related items.</p>
<p>In addition, users typically expect a travel app to provide information about locations, events, and transportation options while also helping them access their private booking or receipt information.</p>
<p>Table 2-4 lists some examples of how a travel app can use search APIs.</p>
<table>
<thead>
<tr>
<th style="text-align:left">API</th>
<th style="text-align:left">Example usage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">NSUserActivity</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">Core Spotlight</td>
<td style="text-align:left">預約<br>使用者附近位置的地點<br>餐廳，酒店或其他被使用者標示為最愛的地點</td>
</tr>
<tr>
<td style="text-align:left">Web markup</td>
<td style="text-align:left"><br>Use universal links to let users open your app when they tap a link to your website.</td>
</tr>
</tbody>
</table>
<hr>
<h1 id="Index-Activities-and-Navigation-Points"><a href="#Index-Activities-and-Navigation-Points" class="headerlink" title="Index Activities and Navigation Points"></a>Index Activities and Navigation Points</h1><p><code>NSUserActivity</code> 提供了讓你捕捉特定 APP 狀態的方法且 navigation points navigation points that the user has previously visited and then restore them later using Handoff (to learn more about enabling Handoff in your app, see Handoff Programming Guide).</p>
<p>iOS 8 之後的 APP，使用者預期 <code>Handoff</code> 能幫助他們從一個裝置上開始一個活動 並且在下個裝置上繼續使用。</p>
<p>除了支援 Handoff, 在 iOS 9 之後使用 <code>NSUserActivity</code> 能讓你:</p>
<ul>
<li><p>Index app items as users perform activities in your app.<br>Activities could include creating or viewing content, viewing a set of items (such as a results list), or visiting a navigation point within your app.</p>
</li>
<li><p>Mark specific items as available for public searching (for some examples of items that can be appropriate for public searching, see Example Implementations)</p>
</li>
<li>Provide indexable metadata about an item, which gives users rich information in search results</li>
</ul>
<p>使用 <code>NSUserActivity APIs</code> 也讓你在 <code>Siri suggestions 和智能提醒(smart reminders)</code> 處於優勢。</p>
<p><code>Siri suggestions</code> 顯示在 <code>Spotlight search screen</code> 且能囊括可搜尋的活動<code>searchable activities</code>。</p>
<p>(注意：只有 high engagement ratio 的活動才有資格顯示在 <code>Siri suggestions</code> 內容中。)</p>
<p>使用者可以使用 <code>Siri smart reminders</code> 提醒一下有特定相關的內容在你的 APP 內。</p>
<p>當使用者收到 <code>smart reminder</code>， the activity they specified is displayed in the reminder.</p>
<p>As the user uses your app, you create activity objects associated with various navigation points and app states. Each item is added to the on-device index by default. In iOS 9, marking a public item as eligible for public indexing also adds it to the on-device index and confers an additional advantage: When you use web markup to make your related website content searchable, user engagement with publicly eligible search results from your app can help improve the ranking of your website’s content. When a user taps a searchable activity or state in Spotlight search results, you use NSUserActivity APIs to continue the activity and return the user to the relevant area in your app.</p>
<h3 id="建立可搜尋的活動-Creating-Searchable-Activities"><a href="#建立可搜尋的活動-Creating-Searchable-Activities" class="headerlink" title="建立可搜尋的活動 (Creating Searchable Activities)"></a>建立可搜尋的活動 (Creating Searchable Activities)</h3><p>讓 <code>activity or navigation point</code> 變得可搜尋，建立 <code>NSUserActivity 物件</code> 來呈現它。</p>
<p>使用 <code>NSUserActivity</code> 屬性來標示項目的型態，提供 <code>metadata</code> 來描述它，並讓它夠資格被搜尋。</p>
<p>將一個項目設定有資格被搜尋，代表這個項目被加到裝置索引上 when the item becomes current.</p>
<figure class="highlight swift"><figcaption><span>Listing 3-1 Creating an activity</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// It's recommended that you use reverse DNS notation for the required activity type property.</span></span><br><span class="line"><span class="keyword">var</span> activity:<span class="type">NSUserActivity</span> = <span class="type">NSUserAcivity</span>(activityType: <span class="string">"com.myCompany.myContentType"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set properties that describe the activity and that can be used in search.</span></span><br><span class="line">activity.title = <span class="string">"My Activity Title"</span></span><br><span class="line">activity.userInfo = [<span class="string">"id"</span>: <span class="string">"http://www.mydomain.com/myContentItem/ABC-123"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the item to the private on-device index.</span></span><br><span class="line">activity.eligibleForSearch = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>雖然沒有展示在 Listing 3-1, <code>NSUserActivity</code> 也定義了內容屬性集 <code>contentAttributeSet</code> 的屬性，which lets you specify as many attributes as you need to describe an item.</p>
<p><code>contentAttributeSet</code> 使用 <code>CSSearchableItemAttributeSet 物件</code>，你可以使用 <code>Core Spotlight 物件</code> 來提供 <code>indexable metadata that enriches search results</code></p>
<p>Core Spotlight defines a large number of properties that specify metadata in several topic areas, such as media, events, and messages.</p>
<p>只有 <code>title</code> <code>userInfo</code> 和 <code>contentAttributeSet</code> 是必須的，但是為了給使用者更好的體驗，還是建議你盡可能低提供越多的描述越好。</p>
<p>特別是建議你可以總是提供 <code>thumbnailData and contentDescription(content-specific values)</code></p>
<hr>
<p>三個特別提到的 <code>NSUserActivity</code> 授權(warrant)屬性：</p>
<ul>
<li>eligibleForPublicIndexing</li>
<li>expirationDate</li>
<li>webpageURL</li>
</ul>
<p>活動 <code>Activities</code> 預設情況下是 <code>private</code>。</p>
<p>當你設定項目的 <code>eligibleForPublicIndexing</code> 並且你使用 <code>web markup</code> 讓你的網站上的相關內容物變得可搜尋，user engagement with the item can help improve the ranking of your website’s content.</p>
<hr>
<p>如果你沒有設定適當的過期時間 <code>expirationDate</code>，系統過一段時間後會自動將這項目變成過期。</p>
<hr>
<p>當你的 APP 內容物同時在你的有效網站 且你分別在妳的 APP 用 <code>NSUserActivity APIs</code> 跟 在你的網站上用 <code>web markup</code>時，而 <code>webpageURL</code> 屬性是相當有用的。</p>
<p>特別是你可用 <code>webpageURL</code> 來避免相同項目重複索引的問題。</p>
<p>當你設定 <code>webpageURL</code> 屬性，同時設定 <code>requiredUserInfoKeys</code> 屬性，using the keys of the userInfo dictionary that must be stored.</p>
<p>如果你沒有設定 <code>requiredUserInfoKeys</code>，當活動被儲存的時候 <code>userInfo dictionary</code> 將會是空的。</p>
<hr>
<p>當使用者執行了活動 或 enters the app state associated with the NSUserActivity object you created，你的 APP 會呼叫 <code>becomeCurrent 方法</code> 來標示活動為目前活動。</p>
<p>目前活動會有資格被搜尋且自動被加到隱私裝置索引(就是 <code>CSSearchableIndex</code>)</p>
<p>此外你可以用搜尋結果來啟動 <code>user actions</code>，例如打電話或導引導某地點。</p>
<hr>
<p>為了保證 活動和它的 <code>metadata</code> 被標上索引，你必須對活動保持強引用(<code>strong reference</code>)直到他被標上索引。</p>
<p>這邊有兩種方法：</p>
<ul>
<li>第一種方法就是在 controller 建立活動，並 assign 活動為 controller 的屬性。</li>
<li>第二種方法使用 <code>UIResponder 物件的 userActivity</code>。<br>如果你使用第二種方法，你必須設定 the metadata—such as information in the userInfo property—in the updateUserActivityState: method;<br>否則，你設定在活動的 <code>metadata</code> 將不會被儲存。</li>
</ul>
<figure class="highlight swift"><figcaption><span>ViewController</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.userActivity = activity</span><br></pre></td></tr></table></figure>
<hr>
<p>如果你想要活動有資格被搜尋但是並不是為了用 <code>Handoff</code>。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">activity.eligibleForSearch = <span class="literal">true</span></span><br><span class="line">activity.eligibleForHandoff = <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<hr>
<p>Use Core Spotlight APIs to remove items you indexed using NSUserActivity.</p>
<p>When an item is indexed using both NSUserActivity and Core Spotlight APIs and the item is connected using the relatedUniqueIdentifier property, removing the item by using the Core Spotlight APIs makes the activity ineligible for indexing.</p>
<p>For more information about using the relatedUniqueIdentifier property, see Combine APIs to Increase Coverage.</p>
<hr>
<h3 id="Continuing-Activities-Chosen-in-Search-Results"><a href="#Continuing-Activities-Chosen-in-Search-Results" class="headerlink" title="Continuing Activities Chosen in Search Results"></a>Continuing Activities Chosen in Search Results</h3><p>當使用者從搜尋結果中點擊你添加索引的 <code>NSUserActivity item</code>，你的 APP 應當開啟且回復到相關於那項目的情境(context)。</p>
<p>為了達成這個功能，你的 <code>app delegate</code> 要實做 <code>application:continueUserActivity:restorationHandler:</code>，檢查近來的活動的型態是因為使用者點擊在搜尋結果中被索引的項目而打開 APP。</p>
<p>這個 <code>application:continueUserActivity:restorationHandler:</code> 方法同 <code>Handoff</code>。</p>
<figure class="highlight swift"><figcaption><span>Continuing a user activity</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(UIApplication, continueUserActivity userActivity: NSUserActivity, restorationHandler: [AnyObject]? -&gt; Void)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> userActivity.activityType == <span class="string">"com.myCompany.myContentType"</span> &#123;</span><br><span class="line">        <span class="comment">// Restore app state for this userActivity and associated userInfo value.</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="Index-App-Content"><a href="#Index-App-Content" class="headerlink" title="Index App Content"></a>Index App Content</h1><p>The Core Spotlight framework provides ways to index the content within your app and manage the private on-device index. Core Spotlight works best for indexing user-specific content, such as friends, items marked as favorite, purchased items, and so on. When you use Core Spotlight APIs to make items searchable, you make it easy for users to find their content in Spotlight search results.</p>
<p>At a high level, Core Spotlight APIs help you provide a comprehensive description of an item and to add it to the on-device index. In addition, CoreSpotlight APIs support indexing items at any time, such as when your app loads.</p>
<p>When users tap an indexed item in Spotlight search results, your app delegate’s application:continueUserActivity:restorationHandler: method is called (this is the same method you implement to support Handoff). In this scenario, the activity type your app delegate receives is CSSearchableItemActionType, which helps you determine the app content to show the user. Creating Searchable Items describes the process in more detail.</p>
<p>In addition to using Core Spotlight APIs to make app content searchable, you should also use NSUserActivity APIs to make app states and navigation points searchable (you can learn more about indexing activities in Index Activities and Navigation Points). Both APIs use the same object to provide metadata about searchable items (that is, a CSSearchableItemAttributeSet object), and both give you ways to prevent duplication of items in search results. Unlike the NSUserActivity API, however, Core Spotlight APIs don’t require users to visit the content before it gets indexed. Learn more about the advantages of using multiple search-related APIs in Combine APIs to Increase Coverage.</p>
<h3 id="Creating-Searchable-Items"><a href="#Creating-Searchable-Items" class="headerlink" title="Creating Searchable Items"></a>Creating Searchable Items</h3><p>To make content searchable, first create an attribute set containing properties that specify the metadata you want to display about an item in a search result. The attributes you choose vary, depending on your domain: You can use the attributes that Core Spotlight provides in categories defined on CSSearchableItemAttributeSet, or you can define your own. (If you want to define a custom attribute, be as specific as possible in your definition and use the contentTypeTree property so that your custom attribute can inherit from a known type.)</p>
<p>Next, create a CSSearchableItem object to represent the item and add it to the on-device index. When you create a searchable item, you must specify a unique identifier so that you can access the item in the index. (Note that you need to specify an appropriate expiration date for items that should remain searchable after a period of time; for more information, see expirationDate.) You can also specify a domain identifier that identifies a group or owner for the item and lets you access groups of items at the same time. Listing 4-1 shows how to create a CSSearchableItem object and index it.</p>
<figure class="highlight swift"><figcaption><span>Creating a searchable item and adding it to the on-device index</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create an attribute set to describe an item.</span></span><br><span class="line"><span class="keyword">let</span> attributeSet = <span class="type">CSSearchableItemAttributeSet</span>(itemContentType: kUTTypeData <span class="keyword">as</span> <span class="type">String</span>)</span><br><span class="line"><span class="comment">// Add metadata that supplies details about the item.</span></span><br><span class="line">attributeSet.title = <span class="string">"July Report.Numbers"</span></span><br><span class="line">attributeSet.contentDescription = <span class="string">"iWork Numbers Document"</span></span><br><span class="line">attributeSet.thumbnailData = <span class="type">DocumentImage</span>.jpg</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create an item with a unique identifier, a domain identifier, and the attribute set you created earlier.</span></span><br><span class="line"><span class="keyword">let</span> item = <span class="type">CSSearchableItem</span>(uniqueIdentifier: <span class="string">"1"</span>, domainIdentifier: <span class="string">"file-1"</span>, attributeSet: attributeSet)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add the item to the on-device index.</span></span><br><span class="line"><span class="type">CSSearchableIndex</span>.defaultSearchableIndex().indexSearchableItems([item]) &#123; error <span class="keyword">in</span></span><br><span class="line">   <span class="keyword">if</span> error != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="built_in">print</span>(error?.localizedDescription)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">"Item indexed."</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Using the code shown in Listing 4-1, an item that represents a Numbers document is added to the on-device index. When the user searches for part of the document’s title, the search results look something like this:</p>
<p>When the user taps on a searchable item from your app in Spotlight search results, your app delegate’s application:continueUserActivity:restorationHandler: method is called. In your implementation of this method, check the type of the incoming activity to confirm that your app is opening because the user tapped an indexed item in a search result. Listing 4-2 shows a skeletal implementation of application:continueUserActivity:restorationHandler:.</p>
<figure class="highlight swift"><figcaption><span>Continuing the activity that represents the searchable item</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(UIApplication, continueUserActivity userActivity: NSUserActivity, restorationHandler: [AnyObject]? -&gt; Void)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> userActivity.activityType == <span class="type">CSSearchableItemActionType</span> &#123;</span><br><span class="line">      <span class="comment">// This activity represents an item indexed using Core Spotlight, so restore the context related to the unique identifier.</span></span><br><span class="line">      <span class="comment">// Note that the unique identifier of the Core Spotlight item is set in the activity’s userInfo property for the key CSSearchableItemActivityIdentifier.</span></span><br><span class="line">      <span class="keyword">let</span> uniqueIdentifier = userActivity.userInfo? [<span class="type">CSSearchableItemActivityIdentifier</span>] <span class="keyword">as</span>? <span class="type">String</span></span><br><span class="line">      <span class="comment">// Next, find and open the item specified by uniqueIdentifer.</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The CSSearchableItemAttributeSet class also helps you support actions that users can take from an item in search results; specifically, you can let users make a phone call or get directions to a location. To enable a phone call, set the item’s supportsPhoneCall property to 1 and specify a phone number in the phoneNumbers property. Be sure to enable a phone call action only when it’s appropriate and it represents the primary action a user is likely to take. For example, it makes sense to let users call a business, but it doesn’t make sense to let users call a phone number that happens to be displayed on a research paper.</p>
<p>To help users get directions to a location described in a search result, set the item’s supportsNavigation property to 1 and supply values for the latitude and longitude properties. As with the phone call action, be sure to enable the navigation action only when it makes sense. For example, you wouldn’t enable navigation for a person’s photo, but you could enable navigation for an item that represents a restaurant review.</p>
<h3 id="Maintaining-the-Index"><a href="#Maintaining-the-Index" class="headerlink" title="Maintaining the Index"></a>Maintaining the Index</h3><p>Keeping the on-device index up to date is critical for ensuring that search results from your app remain relevant. When search results contain relevant items, users are more likely to engage with them, which in turn helps to increase the ranking of your searchable items.</p>
<p>Core Spotlight provides several APIs you can use to work with the index and keep it up to date. For example, Listing 4-3 shows how to update the index, using the same method you use to add new items to the index.</p>
<figure class="highlight swift"><figcaption><span>Updating the index</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">indexSearchableItems</span><span class="params">(items: [CSSearchableItem], completionHandler: <span class="params">(<span class="params">(NSerror?)</span></span></span></span> -&gt; <span class="type">Void</span>)?)</span><br></pre></td></tr></table></figure>
<p>You also use the indexSearchableItems:completionHandler: method to update an item’s title, description, or any other property.</p>
<p>To ensure that only relevant items are returned in search results, you may need to delete indexed items. Core Spotlight provides a few ways to remove items from the index, three of which are shown in Listing 4-4.</p>
<figure class="highlight swift"><figcaption><span>Three ways to delete items from the on-device index</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Delete the items represented by an array of unique identifiers.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteSearchableItemsWithIdentifiers</span><span class="params">(identifiers: [String], completionHandler: <span class="params">(<span class="params">(NSError?)</span></span></span></span> -&gt; <span class="type">Void</span>)?)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete the items represented by an array of domains.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteSearchableItemsWithDomainIdentifiers</span><span class="params">(domainIdentifiers: [String], completionHandler: <span class="params">(<span class="params">(NSError?)</span></span></span></span> -&gt; <span class="type">Void</span>)?)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete all items from the on-device index.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteAllSearchableItemsWithCompletionHandler</span><span class="params">(completionHandler: <span class="params">(<span class="params">(NSError?)</span></span></span></span> -&gt; <span class="type">Void</span>)?)</span><br></pre></td></tr></table></figure>
<h3 id="Using-Advanced-Features"><a href="#Using-Advanced-Features" class="headerlink" title="Using Advanced Features"></a>Using Advanced Features</h3><p>Core Spotlight supports advanced features that help you batch updates to the index and, in case there was a problem indexing your data, perform index updates while your app isn’t running. For example, Core Spotlight includes support for data protection classes that help you choose the appropriate security policy for the information that you’re indexing (to learn more about using protection classes, see initWithName:protectionClass:). To take advantage of Core Spotlight advanced features, be sure to set the indexDelegate property in your app and implement the required methods of CSSearchableIndexDelegate.</p>
<p>When you have to index multiple items, you can break the task into batches and save the state of your indexing process. Listing 4-5 shows how to perform a batched update to the index.</p>
<figure class="highlight objc"><figcaption><span>Batching updates to the index</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CSSearchableIndex *index = [CSSearchableIndex new];</span><br><span class="line">[index beginIndexBatch];</span><br><span class="line">[index indexSearchableitems:items completionHandler:<span class="literal">nil</span>];</span><br><span class="line">[index deleteSearchableItemsWithIdentifiers:identifiers completionHandler:<span class="literal">nil</span>];</span><br><span class="line">[index endIndexBatchWithClientState:clientState completionHandler:^(<span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">    <span class="comment">// Handle errors.</span></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>To resume indexing, use the value of the clientState parameter to determine where to restart, as shown in Listing 4-6.</p>
<figure class="highlight objc"><figcaption><span>Restarting a batched update to the index</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CSSearchableIndex *index = [CSSearchableIndex new];</span><br><span class="line">[index fetchLastClientStateWithCompletionHandler:^(<span class="built_in">NSData</span> *clientState, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(error == <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="built_in">NSArray</span> *items = <span class="comment">// Fetch a batch of items for the specified client state.</span></span><br><span class="line">        [index beginIndexBatch];</span><br><span class="line">        [index indexSearchableitems:items completionHandler:<span class="literal">nil</span>];</span><br><span class="line">        [index endIndexBatchWithClientState:clientState completionHandler:^(<span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">            <span class="comment">// Handle errors.</span></span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>Core Spotlight defines an app extension you can implement to index items when your app isn’t running. The system calls this extension when the index is lost or there was a problem saving data that had been indexed, which can happen if the app crashes. Listing 4-7 shows one way to write this type of app extension.</p>
<figure class="highlight objc"><figcaption><span>Listing 4-7 Creating an index-maintenance app extension</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyIndexRequestExtensionHandler</span> : <span class="title">CSIndexExtensionRequestHandler</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyIndexRequestExtensionHandler</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)searchableIndex:(CSSearchableIndex *)searchableIndex reindexAllSearchableItemsWithAcknowledgementHandler:(<span class="keyword">void</span> (^)(<span class="keyword">void</span>))acknowledgementHandler &#123;</span><br><span class="line">    <span class="comment">// Use index API to re-index all your data.</span></span><br><span class="line">    <span class="comment">// Call the acknowledgement handler when this is done.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)searchableIndex:(CSSearchableIndex *)searchableIndex reindexSearchableItemsWithIdentifiers:(<span class="built_in">NSArray</span> *)identifiers acknowledgementHandler:(<span class="keyword">void</span> (^)(<span class="keyword">void</span>))acknowledgementHandler &#123;</span><br><span class="line">    <span class="comment">// Use index API to re-index data with the specified identifiers.</span></span><br><span class="line">    <span class="comment">// Call the acknowledgement handler when this is done.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

    </div>

    

    
        <div class="post-tags">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <a href="/tags/未完/">#未完</a>
        </div>
    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>

</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    工作時的筆記
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2016/12/05/OpenWRT-2016-12-05-uhttp-lua/">uhttp lua</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/12/01/Linux-2016-12-01-let-s-Make/">let&#39;s Make</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/11/24/OpenWRT-2016-11-24-OpenWRT-uci/">OpenWRT uci</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/11/24/OpenWRT-2016-11-24-OpenWRT-ubus/">OpenWRT ubus</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>Categories</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/IOS/UI/">UI</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/Work/">Work</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/Design-Pattern/Dependency-Injection/">Dependency Injection</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/Google-API/">Google API</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/yume190">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.facebook.com/yume190">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:yume190@gmail.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>